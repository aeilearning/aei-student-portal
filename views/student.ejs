<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>AEI Student</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="container">

  <div class="topbar">
    <div>
      <h1>Student Dashboard</h1>
      <div class="muted">Logged in as <b><%= user.email %></b></div>
    </div>
    <a class="link" href="/logout">Logout</a>
  </div>

  <% if (message) { %>
    <div class="alert"><%= message %></div>
  <% } %>

  <% if (pendingChanges && pendingChanges.length) { %>
    <div class="card">
      <h2>Pending Updates</h2>
      <p class="muted small">
        Updates are held for admin approval before they are finalized in your profile.
      </p>
      <table class="table">
        <thead>
          <tr>
            <th>Section</th>
            <th>Submitted</th>
          </tr>
        </thead>
        <tbody>
          <% pendingChanges.forEach(change => { %>
            <tr>
              <td><%= change.section %></td>
              <td class="small"><%= new Date(change.created_at).toLocaleString() %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } %>

  <div class="card">
    <h2>Apprentice Information (Required)</h2>
    <form method="POST" action="/student/update-identity" class="grid2">
      <div class="stack">
        <label>First Name *</label>
        <input name="first_name" value="<%= student.first_name || '' %>" required />
      </div>

      <div class="stack">
        <label>Middle Name</label>
        <input name="middle_name" value="<%= student.middle_name || '' %>" />
      </div>

      <div class="stack">
        <label>Last Name *</label>
        <input name="last_name" value="<%= student.last_name || '' %>" required />
      </div>

      <div class="stack">
        <label>Suffix</label>
        <input name="suffix" value="<%= student.suffix || '' %>" />
      </div>

      <div class="stack">
        <label>Address *</label>
        <input name="address" value="<%= student.address || '' %>" required />
      </div>

      <div class="stack">
        <label>City *</label>
        <input name="city" value="<%= student.city || '' %>" required />
      </div>

      <div class="stack">
        <label>State *</label>
        <input name="state" value="<%= student.state || '' %>" maxlength="2" required />
      </div>

      <div class="stack">
        <label>Zip Code *</label>
        <input name="zip_code" value="<%= student.zip_code || '' %>" pattern="\d{5}" required />
      </div>

      <div class="stack">
        <label>Phone *</label>
        <input name="phone" value="<%= student.phone || '' %>" required />
      </div>

      <div class="stack">
        <label>Employer Name *</label>
        <input name="employer_name" value="<%= student.employer_name || '' %>" required />
      </div>

      <div class="stack">
        <label>Email</label>
        <div class="muted"><%= user.email %></div>
      </div>

      <div class="stack">
        <label>Social Security Number *</label>
        <input name="ssn" value="<%= student.ssn || '' %>" />
        <label class="small" style="margin-top:6px;">
          <input type="checkbox" name="ssn_not_provided" <%= student.ssn_not_provided ? 'checked' : '' %> />
          Social Security Number Not Provided
        </label>
      </div>

      <div class="stack">
        <label>Date of Birth *</label>
        <input
          type="date"
          name="date_of_birth"
          value="<%= student.date_of_birth ? new Date(student.date_of_birth).toISOString().slice(0,10) : '' %>"
          required
        />
      </div>

      <div class="stack">
        <label>Sex *</label>
        <select name="sex" required>
          <option value="">Select one</option>
          <option value="Male" <%= student.sex === 'Male' ? 'selected' : '' %>>Male</option>
          <option value="Female" <%= student.sex === 'Female' ? 'selected' : '' %>>Female</option>
          <option value="Non-Binary" <%= student.sex === 'Non-Binary' ? 'selected' : '' %>>Non-Binary</option>
          <option value="Unknown" <%= student.sex === 'Unknown' ? 'selected' : '' %>>Unknown</option>
        </select>
      </div>

      <div class="stack">
        <label>Employment Status *</label>
        <select name="employment_status" required>
          <option value="">Select one</option>
          <option value="Employed" <%= student.employment_status === 'Employed' ? 'selected' : '' %>>Employed</option>
          <option value="Unemployed" <%= student.employment_status === 'Unemployed' ? 'selected' : '' %>>Unemployed</option>
        </select>
      </div>

      <div class="stack">
        <label>Completed Pre-Apprenticeship? *</label>
        <select name="pre_apprenticeship" required>
          <option value="">Select one</option>
          <option value="Yes" <%= student.pre_apprenticeship === 'Yes' ? 'selected' : '' %>>Yes</option>
          <option value="No" <%= student.pre_apprenticeship === 'No' ? 'selected' : '' %>>No</option>
        </select>
      </div>

      <div class="stack">
        <label>Level</label>
        <div class="muted"><%= student.level %></div>
      </div>

      <div class="stack">
        <label>Status</label>
        <div class="muted"><%= student.status || '' %></div>
      </div>

      <div>
        <button>Save Apprentice Information</button>
      </div>
    </form>
  </div>

  <div class="card">
    <h2>Demographics (Required)</h2>
    <form method="POST" action="/student/update-demographics" class="grid2">
      <div class="stack">
        <label>Ethnicity *</label>
        <select name="ethnicity" required>
          <option value="">Select one</option>
          <option value="Hispanic or Latino" <%= student.ethnicity === 'Hispanic or Latino' ? 'selected' : '' %>>Hispanic or Latino</option>
          <option value="Non-Hispanic or Latino" <%= student.ethnicity === 'Non-Hispanic or Latino' ? 'selected' : '' %>>Non-Hispanic or Latino</option>
          <option value="Participant Did Not Self-Identify" <%= student.ethnicity === 'Participant Did Not Self-Identify' ? 'selected' : '' %>>Participant Did Not Self-Identify</option>
        </select>
      </div>

      <div class="stack">
        <label>Race *</label>
        <select name="race" required>
          <option value="">Select one</option>
          <option value="American Indian or Alaska Native" <%= student.race === 'American Indian or Alaska Native' ? 'selected' : '' %>>American Indian or Alaska Native</option>
          <option value="Asian" <%= student.race === 'Asian' ? 'selected' : '' %>>Asian</option>
          <option value="Black or African American" <%= student.race === 'Black or African American' ? 'selected' : '' %>>Black or African American</option>
          <option value="Native Hawaiian or Other Pacific Islander" <%= student.race === 'Native Hawaiian or Other Pacific Islander' ? 'selected' : '' %>>Native Hawaiian or Other Pacific Islander</option>
          <option value="White" <%= student.race === 'White' ? 'selected' : '' %>>White</option>
          <option value="Do not wish to answer" <%= student.race === 'Do not wish to answer' ? 'selected' : '' %>>Do not wish to answer</option>
        </select>
      </div>

      <div class="stack">
        <label>Veteran Status *</label>
        <select name="veteran_status" required>
          <option value="">Select one</option>
          <option value="Non Veteran" <%= student.veteran_status === 'Non Veteran' ? 'selected' : '' %>>Non Veteran</option>
          <option value="Veteran" <%= student.veteran_status === 'Veteran' ? 'selected' : '' %>>Veteran</option>
          <option value="Non Veteran, Other Eligible Individual" <%= student.veteran_status === 'Non Veteran, Other Eligible Individual' ? 'selected' : '' %>>Non Veteran, Other Eligible Individual</option>
          <option value="Veteran, Eligible" <%= student.veteran_status === 'Veteran, Eligible' ? 'selected' : '' %>>Veteran, Eligible</option>
          <option value="Participant Did Not Self-Identify" <%= student.veteran_status === 'Participant Did Not Self-Identify' ? 'selected' : '' %>>Participant Did Not Self-Identify</option>
        </select>
      </div>

      <div class="stack">
        <label>Education Level *</label>
        <select name="education_level" required>
          <option value="">Select one</option>
          <option value="Not High School Graduate" <%= student.education_level === 'Not High School Graduate' ? 'selected' : '' %>>Not High School Graduate</option>
          <option value="High School Graduate (including equivalency)" <%= student.education_level === 'High School Graduate (including equivalency)' ? 'selected' : '' %>>High School Graduate (including equivalency)</option>
          <option value="Some College or Associate's degree" <%= student.education_level === "Some College or Associate's degree" ? 'selected' : '' %>>Some College or Associate's degree</option>
          <option value="Bachelor's degree" <%= student.education_level === "Bachelor's degree" ? 'selected' : '' %>>Bachelor's degree</option>
          <option value="Master's degree" <%= student.education_level === "Master's degree" ? 'selected' : '' %>>Master's degree</option>
          <option value="Doctorate or professional degree" <%= student.education_level === 'Doctorate or professional degree' ? 'selected' : '' %>>Doctorate or professional degree</option>
          <option value="Participant Did Not Self-Identify" <%= student.education_level === 'Participant Did Not Self-Identify' ? 'selected' : '' %>>Participant Did Not Self-Identify</option>
        </select>
      </div>

      <div class="stack">
        <label>Disability *</label>
        <select name="disability" required>
          <option value="">Select one</option>
          <option value="Yes" <%= student.disability === 'Yes' ? 'selected' : '' %>>Yes</option>
          <option value="No" <%= student.disability === 'No' ? 'selected' : '' %>>No</option>
          <option value="Participant Did Not Self-Identify" <%= student.disability === 'Participant Did Not Self-Identify' ? 'selected' : '' %>>Participant Did Not Self-Identify</option>
        </select>
      </div>

      <div>
        <button>Save Demographics</button>
      </div>
    </form>
  </div>

  <div class="card">
    <h2>RAPIDS Fields (Required)</h2>
    <form method="POST" action="/student/update-rapids" class="grid2">
      <div class="stack">
        <label>Program Name *</label>
        <input name="program_name" value="<%= student.program_name || '' %>" required />
      </div>

      <div class="stack">
        <label>Provider Program ID *</label>
        <input name="provider_program_id" value="<%= student.provider_program_id || '' %>" required />
      </div>

      <div class="stack">
        <label>Program System ID *</label>
        <input name="program_system_id" value="<%= student.program_system_id || '' %>" required />
      </div>

      <div class="stack">
        <label>Student ID Number *</label>
        <input name="student_id_no" value="<%= student.student_id_no || '' %>" required />
      </div>

      <div class="stack">
        <label>Student ID Type *</label>
        <select name="student_id_type" required>
          <% STUDENT_ID_TYPES.forEach(t => { %>
            <option value="<%= t %>" <%= student.student_id_type === t ? 'selected' : '' %>><%= t %></option>
          <% }) %>
        </select>
      </div>

      <div class="stack">
        <label>Enrollment Date *</label>
        <input
          type="date"
          name="enrollment_date"
          value="<%= student.enrollment_date ? new Date(student.enrollment_date).toISOString().slice(0,10) : '' %>"
          required
        />
      </div>

      <div class="stack">
        <label>Exit Date</label>
        <input
          type="date"
          name="exit_date"
          value="<%= student.exit_date ? new Date(student.exit_date).toISOString().slice(0,10) : '' %>"
        />
      </div>

      <div class="stack">
        <label>Exit Type</label>
        <input name="exit_type" value="<%= student.exit_type || '' %>" />
      </div>

      <div class="stack">
        <label>Credential</label>
        <input name="credential" value="<%= student.credential || '' %>" />
      </div>

      <div>
        <button>Save RAPIDS Fields</button>
      </div>
    </form>
  </div>

  <div class="card">
    <h2>Occupation Information (Required)</h2>
    <form method="POST" action="/student/update-occupation" class="grid2">
      <div class="stack">
        <label>Occupation Name *</label>
        <input name="occupation_name" value="<%= student.occupation_name || '' %>" required />
      </div>

      <div class="stack">
        <label>Occupation Code *</label>
        <input name="occupation_code" value="<%= student.occupation_code || '' %>" required />
      </div>

      <div class="stack">
        <label>Enrollment Date *</label>
        <input
          type="date"
          name="enrollment_date"
          value="<%= student.enrollment_date ? new Date(student.enrollment_date).toISOString().slice(0,10) : '' %>"
          required
        />
      </div>

      <div class="stack">
        <label>Probationary Period (Hours) *</label>
        <input type="number" name="probationary_period_hours" value="<%= student.probationary_period_hours ?? '' %>" required />
      </div>

      <div class="stack">
        <label>Term Remaining (Hours) *</label>
        <input type="number" name="term_remaining_hours" value="<%= student.term_remaining_hours ?? '' %>" required />
      </div>

      <div class="stack">
        <label>Expected Completion Date *</label>
        <input
          type="date"
          name="expected_completion_date"
          value="<%= student.expected_completion_date ? new Date(student.expected_completion_date).toISOString().slice(0,10) : '' %>"
          required
        />
      </div>

      <div class="stack">
        <label>Credit for Previous On-the-Job Learning (Hours) *</label>
        <input type="number" name="otjl_credit_hours" value="<%= student.otjl_credit_hours ?? '' %>" required />
      </div>

      <div class="stack">
        <label>Credit for Previous Related Instruction (Hours) *</label>
        <input type="number" name="related_instruction_credit_hours" value="<%= student.related_instruction_credit_hours ?? '' %>" required />
      </div>

      <div class="stack">
        <label>Related Instruction Provider *</label>
        <input name="related_instruction_provider" value="<%= student.related_instruction_provider || '' %>" required />
      </div>

      <div class="stack">
        <label>Entry Wage *</label>
        <input type="number" step="0.01" name="entry_wage" value="<%= student.entry_wage ?? '' %>" required />
      </div>

      <div class="stack">
        <label>Entry Wage Units *</label>
        <input name="entry_wage_units" value="<%= student.entry_wage_units || '' %>" required />
      </div>

      <div class="stack">
        <label>Wage Schedule *</label>
        <input name="wage_schedule" value="<%= student.wage_schedule || '' %>" required />
      </div>

      <div class="stack">
        <label>Journeyworker Wage (Hourly) *</label>
        <input type="number" step="0.01" name="journeyworker_wage" value="<%= student.journeyworker_wage ?? '' %>" required />
      </div>

      <div>
        <button>Save Occupation Information</button>
      </div>
    </form>
  </div>

  <div class="card">
    <h2>Documents</h2>
    <form method="POST" action="/student/docs/upload" enctype="multipart/form-data" class="grid2">
      <div class="stack">
        <label>Document Type *</label>
        <select name="doc_type" required>
          <% DOC_TYPES.forEach(t => { %>
            <option value="<%= t %>"><%= t %></option>
          <% }) %>
        </select>
      </div>
      <div class="stack">
        <label>Title (optional)</label>
        <input name="title" />
      </div>
      <div class="stack">
        <label>File *</label>
        <input type="file" name="doc_file" required />
      </div>
      <div>
        <button>Upload Document</button>
      </div>
    </form>

    <% if (!documents || !documents.length) { %>
      <div class="muted small" style="margin-top:10px;">No documents available yet.</div>
    <% } else { %>
      <table class="table" style="margin-top:10px;">
        <thead>
          <tr>
            <th>Type</th>
            <th>Title</th>
            <th>Uploaded</th>
            <th>Status</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% documents.forEach(d => { %>
            <tr>
              <td><%= d.doc_type %></td>
              <td><%= d.title %></td>
              <td class="small"><%= new Date(d.created_at).toLocaleDateString() %></td>
              <td class="small"><%= d.approval_status === 'pending' ? 'Pending approval' : 'Approved' %></td>
              <td><a class="btn" href="/student/docs/<%= d.id %>/download">Download</a></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } %>
  </div>

</body>
</html>
